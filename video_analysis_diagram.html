<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Analysis Pipeline - Multi-Modal AI Processing</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.2em;
        }
        .diagram-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            overflow-x: auto;
        }
        .mermaid {
            background: white;
            border-radius: 10px;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Video Analysis Pipeline</h1>
        <p class="subtitle">Multi-Modal AI Processing: Visual + Audio</p>
        
        <div class="diagram-container">
            <div class="mermaid">
flowchart TD
    START([Video Upload<br/>MP4 File]) --> SPLIT{Video Processing}
    
    SPLIT -->|Visual Path| VISUAL[Visual Analysis]
    SPLIT -->|Audio Path| AUDIO[Audio Analysis]
    
    subgraph VISUAL[" "]
        V1[OpenCV VideoCapture<br/>Extract Video Properties]
        V2[Calculate Frame Indices<br/>Evenly Spaced]
        V3[Extract 5 Key Frames<br/>JPEG Encoding]
        V4[Frame 1 Analysis]
        V5[Frame 2 Analysis]
        V6[Frame 3 Analysis]
        V7[Frame 4 Analysis]
        V8[Frame 5 Analysis]
        V9[GPT-4 Vision API<br/>Image â†’ Text Description]
        
        V1 --> V2
        V2 --> V3
        V3 --> V4
        V3 --> V5
        V3 --> V6
        V3 --> V7
        V3 --> V8
        V4 --> V9
        V5 --> V9
        V6 --> V9
        V7 --> V9
        V8 --> V9
    end
    
    subgraph AUDIO[" "]
        A1[ffmpeg Subprocess<br/>Extract Audio Track]
        A2[Convert to WAV<br/>PCM 16-bit, 44.1kHz, Stereo]
        A3[ElevenLabs STT API<br/>scribe_v1 Model]
        A4{Retry Logic<br/>Rate Limited?}
        A5[Exponential Backoff<br/>2s, 4s, 8s]
        A6[Transcription Result<br/>Text + Word Timestamps]
        
        A1 --> A2
        A2 --> A3
        A3 --> A4
        A4 -->|429 Error| A5
        A5 --> A3
        A4 -->|Success| A6
    end
    
    VISUAL --> COMBINE[Combine Results]
    AUDIO --> COMBINE
    
    COMBINE --> JSON[JSON Response<br/>frame_analysis[]<br/>audio_transcription{}<br/>summary{}]
    
    JSON --> END([Response to Client])
    
    style START fill:#e3f2fd,stroke:#1976d2,stroke-width:3px
    style VISUAL fill:#e8f5e9,stroke:#388e3c,stroke-width:3px
    style AUDIO fill:#fff3e0,stroke:#f57c00,stroke-width:3px
    style V9 fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px
    style A3 fill:#ffe0b2,stroke:#f57c00,stroke-width:2px
    style COMBINE fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    style JSON fill:#c8e6c9,stroke:#2e7d32,stroke-width:3px
    style END fill:#e3f2fd,stroke:#1976d2,stroke-width:3px
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                fontSize: '18px'
            },
            flowchart: {
                curve: 'basis',
                padding: 12,
                nodeSpacing: 30,
                rankSpacing: 50,
                htmlLabels: true
            }
        });
    </script>
</body>
</html>

