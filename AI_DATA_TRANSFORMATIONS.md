# AI Data Transformations: Technical Deep Dive

## ğŸ”„ Complete Data Flow Through AI Pipeline

```mermaid
graph LR
    subgraph "Input Layer"
        A[Raw Image<br/>JPEG/PNG Bytes] --> B[Raw Video<br/>MP4 Bytes]
    end
    
    subgraph "Preprocessing"
        B --> C[PIL Image<br/>Decode Bytes]
        B --> D[OpenCV<br/>VideoCapture]
        D --> E[Frame Extraction<br/>5 Frames]
        E --> F[JPEG Encoding<br/>cv2.imencode]
        B --> G[ffmpeg<br/>Audio Extraction]
        G --> H[WAV Audio<br/>PCM 16-bit]
    end
    
    subgraph "AI Processing Layer"
        C --> I[GPT-4 Vision<br/>Image Analysis]
        F --> I
        I --> J[Text Description<br/>1500 tokens max]
        J --> K[text-embedding-3-small<br/>Embedding Model]
        K --> L[1536-dim Vector<br/>float32]
        H --> M[ElevenLabs STT<br/>scribe_v1]
        M --> N[Transcription Text<br/>+ Word Timestamps]
    end
    
    subgraph "Vector Database"
        L --> O[FAISS Index<br/>IndexFlatL2]
        O --> P[Vector Storage<br/>Binary Format]
        O --> Q[Metadata Storage<br/>Pickle Format]
    end
    
    subgraph "Search & Matching"
        L --> R[FAISS Search<br/>L2 Distance]
        R --> S[Similarity Score<br/>Percentage]
        S --> T[Ranked Results<br/>Top 5]
    end
    
    subgraph "Output Layer"
        J --> U[JSON Response<br/>Description]
        N --> U
        T --> U
    end
```

---

## ğŸ§¬ Detailed AI Transformation Pipeline

### Transformation 1: Image â†’ Text Description

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INPUT: Image Bytes (JPEG/PNG)                               â”‚
â”‚ Size: Variable (KB to MB)                                    â”‚
â”‚ Format: Binary image data                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Image Decoding                                      â”‚
â”‚ PIL.Image.open(BytesIO(image_bytes))                       â”‚
â”‚ Output: PIL Image object                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Base64 Encoding                                     â”‚
â”‚ base64.b64encode(image_bytes)                                â”‚
â”‚ Output: Base64 string                                        â”‚
â”‚ Format: "data:image/jpeg;base64,/9j/4AAQSkZJRg..."          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: AI Model Input Preparation                          â”‚
â”‚ {                                                           â”‚
â”‚   "type": "image_url",                                      â”‚
â”‚   "image_url": {                                            â”‚
â”‚     "url": "data:image/jpeg;base64,..."                    â”‚
â”‚   }                                                         â”‚
â”‚ }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: GPT-4 Vision Processing                             â”‚
â”‚ Model: gpt-4o                                               â”‚
â”‚ Input: System Prompt + Image                                â”‚
â”‚ Processing:                                                  â”‚
â”‚   - Visual feature extraction                                â”‚
â”‚   - Food recognition                                        â”‚
â”‚   - Ingredient identification                               â”‚
â”‚   - Preparation style analysis                              â”‚
â”‚   - Aroma/flavor inference                                  â”‚
â”‚ Output: Text description (max 1500 tokens)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OUTPUT: Text Description                                    â”‚
â”‚ Format: Natural language string                             â”‚
â”‚ Example:                                                    â”‚
â”‚ "This image shows a grilled beef burger with melted        â”‚
â”‚  cheddar cheese, crisp lettuce, sliced tomatoes, and        â”‚
â”‚  pickles on a toasted sesame seed bun. The patty appears   â”‚
â”‚  to be medium-well done with visible grill marks..."       â”‚
â”‚ Length: ~500-1500 tokens                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**AI Model Details:**
- **Model**: `gpt-4o` (multimodal)
- **Vision Capability**: Analyzes image content
- **Token Limit**: 1500 tokens output
- **Temperature**: 0 (deterministic responses)
- **Processing Time**: 2-5 seconds per image

---

### Transformation 2: Text Description â†’ Vector Embedding

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INPUT: Text Description                                      â”‚
â”‚ Format: Natural language string                             â”‚
â”‚ Length: ~500-1500 tokens                                    â”‚
â”‚ Example: "Grilled beef burger with cheddar..."             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: API Request Preparation                              â”‚
â”‚ {                                                           â”‚
â”‚   "model": "text-embedding-3-small",                        â”‚
â”‚   "input": "Grilled beef burger with cheddar..."           â”‚
â”‚ }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: OpenAI Embeddings API Processing                   â”‚
â”‚ Model: text-embedding-3-small                               â”‚
â”‚ Processing:                                                  â”‚
â”‚   - Tokenization                                            â”‚
â”‚   - Neural network encoding                                 â”‚
â”‚   - Semantic feature extraction                             â”‚
â”‚   - Dimensionality: 1536                                    â”‚
â”‚ Output: Vector array (1536 dimensions)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Vector Conversion                                   â”‚
â”‚ np.array(response.data[0].embedding, dtype=np.float32)     â”‚
â”‚ Output: NumPy array                                          â”‚
â”‚ Shape: (1536,)                                               â”‚
â”‚ Data Type: float32                                           â”‚
â”‚ Example: [0.0234, -0.1456, 0.7891, ..., 0.0123]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OUTPUT: 1536-Dimensional Vector                             â”‚
â”‚ Format: NumPy array (float32)                               â”‚
â”‚ Properties:                                                  â”‚
â”‚   - Semantic representation of text                          â”‚
â”‚   - Captures meaning, not just words                        â”‚
â”‚   - Similar texts â†’ similar vectors                         â”‚
â”‚   - Ready for similarity search                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Embedding Model Details:**
- **Model**: `text-embedding-3-small`
- **Dimensions**: 1536
- **Data Type**: float32
- **Semantic Properties**: 
  - Similar meanings â†’ close vectors
  - Cosine similarity or L2 distance for comparison
- **Processing Time**: 0.5-1 second

---

### Transformation 3: Vector â†’ FAISS Index Storage

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INPUT: 1536-dim Vector (float32)                            â”‚
â”‚ Shape: (1536,)                                              â”‚
â”‚ Example: [0.0234, -0.1456, ..., 0.0123]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Reshape for FAISS                                   â”‚
â”‚ embedding.reshape(1, -1)                                    â”‚
â”‚ Output Shape: (1, 1536) - 2D array required by FAISS       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Add to FAISS Index                                  â”‚
â”‚ faiss_index.add(embedding)                                  â”‚
â”‚ Processing:                                                  â”‚
â”‚   - Append vector to index                                   â”‚
â”‚   - Increment ntotal counter                                â”‚
â”‚   - Store in memory (IndexFlatL2)                           â”‚
â”‚ Output: Index updated (ntotal += 1)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Store Metadata                                      â”‚
â”‚ faiss_metadata.append({                                     â”‚
â”‚   "image_path": "samples/1.jpg",                           â”‚
â”‚   "description": "Grilled beef burger...",                  â”‚
â”‚   "description_variation": 1,                              â”‚
â”‚   "image_index": 123                                        â”‚
â”‚ })                                                          â”‚
â”‚ Output: Metadata list updated                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Persistence (on shutdown)                           â”‚
â”‚ faiss.write_index(faiss_index, "faiss_index.bin")          â”‚
â”‚ pickle.dump(faiss_metadata, "faiss_metadata.pkl")           â”‚
â”‚ Output: Binary files on disk                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**FAISS Index Details:**
- **Index Type**: `IndexFlatL2` (exact L2 distance)
- **Storage**: In-memory during runtime, binary file on disk
- **Search Complexity**: O(n) where n = number of vectors
- **Memory**: ~6KB per vector (1536 * 4 bytes)

---

### Transformation 4: Query Vector â†’ Similarity Search

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INPUT: Query Image                                           â”‚
â”‚ Format: Image bytes (JPEG/PNG)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Generate Query Description                          â”‚
â”‚ GPT-4 Vision â†’ Text Description                             â”‚
â”‚ Output: "Grilled beef burger with..."                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Generate Query Embedding                           â”‚
â”‚ text-embedding-3-small â†’ 1536-dim Vector                    â”‚
â”‚ Output: query_vector (1, 1536)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: FAISS Search                                        â”‚
â”‚ faiss_index.search(query_vector, k=5)                       â”‚
â”‚ Processing:                                                  â”‚
â”‚   - Calculate L2 distance to all vectors                    â”‚
â”‚   - Sort by distance (ascending)                            â”‚
â”‚   - Return top k results                                    â”‚
â”‚ Output: (distances, indices)                                â”‚
â”‚   distances: [0.5, 0.7, 0.9, 1.1, 1.3]                    â”‚
â”‚   indices: [42, 15, 88, 3, 127]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Distance â†’ Similarity Conversion                     â”‚
â”‚ similarity = (1 / (1 + distance)) * 100                     â”‚
â”‚ Examples:                                                    â”‚
â”‚   distance=0.1  â†’ similarity=90.91%                        â”‚
â”‚   distance=0.5  â†’ similarity=66.67%                        â”‚
â”‚   distance=1.0  â†’ similarity=50.00%                        â”‚
â”‚   distance=2.0  â†’ similarity=33.33%                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: Load Metadata for Results                          â”‚
â”‚ For each index:                                             â”‚
â”‚   - Load description from metadata                          â”‚
â”‚   - Load image_path                                         â”‚
â”‚   - Attach similarity score                                â”‚
â”‚ Output: Ranked results with metadata                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OUTPUT: Search Results                                      â”‚
â”‚ [                                                            â”‚
â”‚   {                                                         â”‚
â”‚     "rank": 1,                                              â”‚
â”‚     "image_path": "samples/42.jpg",                         â”‚
â”‚     "description": "Grilled beef burger...",                â”‚
â”‚     "similarity_percentage": 90.91,                         â”‚
â”‚     "distance": 0.1                                         â”‚
â”‚   },                                                        â”‚
â”‚   ...                                                       â”‚
â”‚ ]                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Transformation 5: Video â†’ Multi-Modal Analysis

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INPUT: Video File (MP4)                                     â”‚
â”‚ Format: MP4 video bytes                                     â”‚
â”‚ Size: Variable (MB to GB)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                       â”‚
                â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ VISUAL PATH           â”‚   â”‚ AUDIO PATH            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                       â”‚
                â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VISUAL: Frame Extraction                                    â”‚
â”‚ OpenCV VideoCapture                                          â”‚
â”‚ - Get total_frames, fps, duration                           â”‚
â”‚ - Calculate evenly-spaced indices                           â”‚
â”‚ - Extract 5 key frames                                      â”‚
â”‚ Output: 5 frame images (JPEG)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VISUAL: Frame Analysis (5x)                                 â”‚
â”‚ For each frame:                                             â”‚
â”‚   GPT-4 Vision â†’ Frame Description                          â”‚
â”‚ Output: 5 frame descriptions with timestamps                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AUDIO: Audio Extraction                                     â”‚
â”‚ ffmpeg subprocess:                                          â”‚
â”‚   - Extract audio track                                      â”‚
â”‚   - Convert to WAV (PCM 16-bit, 44.1kHz, Stereo)           â”‚
â”‚ Output: WAV audio bytes                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AUDIO: Speech-to-Text                                       â”‚
â”‚ ElevenLabs STT API (scribe_v1):                            â”‚
â”‚   - Transcribe audio to text                                â”‚
â”‚   - Generate word-level timestamps                          â”‚
â”‚   - Detect language                                          â”‚
â”‚ Output: Transcription with word timestamps                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OUTPUT: Combined Analysis                                   â”‚
â”‚ {                                                           â”‚
â”‚   "frame_analysis": [                                       â”‚
â”‚     {"frame_index": 0, "timestamp": 0.0, "description": "..."}, â”‚
â”‚     ...                                                     â”‚
â”‚   ],                                                        â”‚
â”‚   "audio_transcription": {                                  â”‚
â”‚     "text": "Transcribed text...",                         â”‚
â”‚     "words": [{"text": "word", "start": 0.5, "end": 0.7}], â”‚
â”‚     "language": "en"                                        â”‚
â”‚   }                                                         â”‚
â”‚ }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Type Transformations Summary

| Stage | Input Type | Output Type | Transformation |
|-------|------------|-------------|----------------|
| Image Upload | Binary bytes | PIL Image | Decode |
| Image â†’ Description | PIL Image | Base64 string | Encode |
| Image â†’ Description | Base64 + Prompt | Text string | GPT-4 Vision AI |
| Description â†’ Embedding | Text string | 1536-dim vector | Embedding AI |
| Vector â†’ FAISS | NumPy array (1, 1536) | FAISS index entry | Index storage |
| Query â†’ Search | Query vector | (distances, indices) | L2 distance calculation |
| Distance â†’ Similarity | L2 distance | Percentage | Mathematical conversion |
| Video â†’ Frames | MP4 bytes | JPEG frames | OpenCV extraction |
| Video â†’ Audio | MP4 bytes | WAV bytes | ffmpeg extraction |
| Audio â†’ Text | WAV bytes | Text + timestamps | ElevenLabs STT AI |

---

## ğŸ¯ AI Model Input/Output Specifications

### GPT-4 Vision (gpt-4o)

**Input:**
```json
{
  "model": "gpt-4o",
  "messages": [
    {
      "role": "system",
      "content": "You are an expert food analysis assistant..."
    },
    {
      "role": "user",
      "content": [
        {
          "type": "text",
          "text": "Analyze this image..."
        },
        {
          "type": "image_url",
          "image_url": {
            "url": "data:image/jpeg;base64,..."
          }
        }
      ]
    }
  ],
  "max_tokens": 1500,
  "temperature": 0
}
```

**Output:**
```json
{
  "choices": [
    {
      "message": {
        "content": "This image shows a grilled beef burger..."
      }
    }
  ]
}
```

### OpenAI Embeddings (text-embedding-3-small)

**Input:**
```json
{
  "model": "text-embedding-3-small",
  "input": "This image shows a grilled beef burger..."
}
```

**Output:**
```json
{
  "data": [
    {
      "embedding": [0.0234, -0.1456, 0.7891, ..., 0.0123],
      "index": 0
    }
  ],
  "model": "text-embedding-3-small",
  "usage": {
    "prompt_tokens": 150,
    "total_tokens": 150
  }
}
```

### ElevenLabs STT (scribe_v1)

**Input:**
```
POST /v1/speech-to-text
Headers: {"xi-api-key": "..."}
Files: {"file": ("audio.wav", audio_bytes, "audio/wav")}
Data: {"model_id": "scribe_v1"}
```

**Output:**
```json
{
  "text": "This is a delicious burger with cheese...",
  "words": [
    {
      "text": "This",
      "start": 0.0,
      "end": 0.2,
      "type": "word"
    },
    ...
  ],
  "language_code": "en"
}
```

---

## ğŸ”¢ Mathematical Operations

### L2 Distance Calculation

```python
# FAISS calculates L2 (Euclidean) distance
distance = sqrt(sum((query_vector[i] - indexed_vector[i])^2 for i in range(1536)))

# Example:
query = [0.1, 0.2, 0.3, ...]
indexed = [0.15, 0.25, 0.35, ...]
distance = sqrt((0.1-0.15)^2 + (0.2-0.25)^2 + ...)
```

### Similarity Percentage Conversion

```python
# Convert L2 distance to similarity percentage
similarity = (1 / (1 + distance)) * 100

# Properties:
# - distance = 0 â†’ similarity = 100% (identical)
# - distance â†’ âˆ â†’ similarity â†’ 0% (completely different)
# - distance = 1 â†’ similarity = 50% (moderate similarity)
```

### Frame Index Calculation

```python
# Calculate evenly-spaced frame indices
total_frames = 1000
num_frames = 5
step = max(1, total_frames // num_frames)  # step = 200
frame_indices = [i * step for i in range(num_frames)]
# Result: [0, 200, 400, 600, 800]
```

---

## âš¡ Performance Characteristics

### Processing Times (Typical)

| Operation | Time | Notes |
|-----------|------|-------|
| Image â†’ Description (GPT-4 Vision) | 2-5s | Depends on image complexity |
| Description â†’ Embedding | 0.5-1s | Fast, cached by OpenAI |
| FAISS Search (1000 vectors) | <10ms | Linear scan |
| Frame Extraction (5 frames) | 1-2s | OpenCV processing |
| Audio Extraction (ffmpeg) | 2-5s | Depends on video length |
| Audio Transcription | 5-15s | ElevenLabs API + retry |

### Memory Usage

| Component | Memory per Item | Notes |
|-----------|----------------|-------|
| Image bytes | Variable | Depends on image size |
| Embedding vector | 6KB | 1536 * 4 bytes (float32) |
| FAISS index (1000 images) | ~30MB | 5 variations = 5000 vectors |
| Metadata entry | ~1-5KB | Depends on description length |
| Video frame (JPEG) | 50-200KB | Compressed |
| Audio (WAV) | Variable | Depends on duration |

---

This diagram shows all AI transformations, data type conversions, and mathematical operations in the backend system.

